{{#projects:i}}
	<div class="result list-item">
		<div class="row">
			<div class="col-md-6">
				<h4>
					<a href='#!{"query":"{{name}}"}'>{{name}}</a>
					<small class="btn-group">
						(<a class="link" data-toggle="dropdown">{{selectedVersion}}</a>)
						<versionList project="{{this}}"></versionList>
					</small>
				</h4>
				<small>by <a href='#!{"query":"author: {{author}}"}'>{{author}}</a></small>
			</div>
			<div class="col-md-6 buttons">
				<button class="btn btn-link btn-inverse gray" on-click="add:{{this}}" decorator="tooltip: Add to collection"><i class="fa fa-check fa-2x"></i></button>
				<button class="btn btn-link btn-inverse gray" on-click="download:{{this}}" decorator="tooltip: Download ZIP"><i class="fa fa-download fa-2x"></i></button>
				<a class="btn btn-link btn-inverse gray" href="{{homepage}}" target="_blank" decorator="tooltip: Homepage"><i class="fa fa-home fa-2x"></i></a>
				<a class="btn btn-link btn-inverse gray" style="{{^github}}visibility: hidden{{/github}}" href="{{github}}" target="_blank" decorator="tooltip: GitHub"><i class="fa fa-github fa-2x"></i></a>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-12">
				<p>{{description}}</p>
			</div>

			<div class="file-list">
				{{# {files: listFiles(this)} }}
					<div class="col-xs-{{#flash}}11{{/flash}}{{^flash}}12{{/flash}}" style="padding-right: 0">
						<input type="text" class="form-control output" value="{{app.cdnRoot}}/{{name}}/{{selectedVersion}}/{{files.0}}">
					</div>
					{{#flash}}
						<div class="col-xs-1" style="padding-right: 0">
							<button class="btn btn-link btn-inverse gray" decorator="zeroClipboard" data-clipboard-text="{{app.cdnRoot}}/{{name}}/{{selectedVersion}}/{{files.0}}">
								<i class="fa fa-chain"></i>
							</button>
						</div>
					{{/flash}}

					{{#files.length > 1}}
						{{#insert}}
							<div class="more-files" style="display: {{showAll ? 'block' : 'none'}}">
								{{#files:j}}
									{{#j > 0}}
										<div class="col-xs-{{#flash}}11{{/flash}}{{^flash}}12{{/flash}}" style="padding-right: 0">
											<input type="text" class="form-control output" value="{{app.cdnRoot}}/{{name}}/{{selectedVersion}}/{{this}}">
										</div>
										{{#flash}}
											<div class="col-xs-1" style="padding-right: 0">
												<button class="btn btn-link btn-inverse gray" decorator="zeroClipboard" data-clipboard-text="{{app.cdnRoot}}/{{name}}/{{selectedVersion}}/{{this}}">
													<i class="fa fa-chain"></i>
												</button>
											</div>
										{{/flash}}
									{{/}}
								{{/files}}
							</div>
						{{/insert}}

						<div class="col-xs-12">
							<button class="btn btn-link btn-inverse gray" on-click="toggle:{{i}}" decorator="tooltip: {{showAll ? 'Show only main file' : 'Show all files'}}">
								<i class="fa {{ showAll ? 'fa-angle-double-up' : 'fa-angle-double-down' }}"></i>
							</button>
						</div>
					{{/files}}
				{{/}}
			</div>
		</div>
	</div>
{{/projects}}

{{#nbPages > 1}}
	<ul class="pager">
		<li class="previous {{^page}}disabled{{/}}"><a class="link" on-click="loadPage:{{page - 1}}"><i class="fa fa-angle-left"></i> Previous Page</a></li>
		<li class="next {{^page < nbPages}}disabled{{/}}"><a class="link" on-click="loadPage:{{page + 1}}">Next Page <i class="fa fa-angle-right"></i></a></li>
	</ul>
{{/}}

<script type="text/javascript">
	var downloadHelper			= require('download');
	var listFiles				= require('list-files');
	var SelectFilesView			= require('rvc!components/select-files');
	var tooltipDecorator		= require('decorators/tooltip');
	var versionList				= require('rvc!components/version-list');
	var zeroClipboardDecorator	= require('decorators/zero-clipboard');

	component.exports		= {
		'components': {
			'versionList'	: versionList
		},
		'data'		: {
			'app'		: {},
			'nbPages'	: 0,
			'flash'		: true,
			'listFiles'	: listFiles,
			'page'		: 0,
			'projects'	: []
		},
		'decorators': {
			'tooltip'		: tooltipDecorator,
			'zeroClipboard'	: zeroClipboardDecorator
		},
		'init'		: function() {
			var _this = this;

			this.on({
				'add'		: function(event, project) {
					new SelectFilesView({
						'data'	: {
							'app'		: this.get('app'),
							'project'	: project,
							'callback'	: function(project) {
								_this.get('app').views.collection.get('projects').push(project);
							}
						}
					});
				},
				'download'	: function(event, project) {
					downloadHelper('//cdn.jsdelivr.net/' + project.name + '/' + project.selectedVersion + '/' + project.zip);
				},
				'loadPage'	: function(event, i) {
					if(i >= 0 && i < this.get('nbPages')) {
						app.views.searchInput.set('page', i);
						$('body, html').scrollTop(0);
					}
				},
				'toggle'	: function(event, i) {
					this.set('projects.' + i + '.insert', true);

					var $body		= $('body');
					var $link		= $(event.node);
					var $moreFiles	= $link.closest('.file-list').find('.more-files');
					var keypath		= 'projects.' + i + '.showAll';

					$moreFiles.slideToggle(200, function() {
						if($link.offset().top < $body.scrollTop()) {
							$('body, html').animate({
								'scrollTop': $link.closest('.list-item').offset().top - 10
							});
						}
						_this.set(keypath, !_this.get(keypath));
					});
				}
			});

			this.observe('projects', function(n) {
				if(n.length === 1 && typeof n[0].showAll === 'undefined') {
					_this.set('projects.0.insert', true);
					_this.set('projects.0.showAll', true);
				}
			});
		}
	}
</script>